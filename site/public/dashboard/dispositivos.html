<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - Dispositivo </title>

    <link rel="shortcut icon" href="../assets/favicon.png" type="image/x-icon">
    <link rel="stylesheet" href="./css/global.css">
    <link rel="stylesheet" href="./css/index.css">
    <link rel="stylesheet" href="./css/dispositivos.css">

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css' rel='stylesheet'>
</head>

<body onload="obterRegistrosCapturados()">
    <div class="Header">
        <div class="body">
            <div class="sidebar">
                <div class="logo_content">
                    <div class="logo">
                    </div>
                    <i class='bx bx-menu' id="btn"></i>
                </div>
                <ul class="nav_list">
                    <div class="profile">
                        <div class="image-container">
                            <img id="userImage" src="../assets/do-utilizador 1.png" alt="Imagem do perfil">
                        </div>
                        <button id="uploadButton" class="small">
                            <i class='bx bxs-pencil'></i>
                        </button>
                        <li>
                            <span class="links_name" id="name_user">Ncolly juliani </span>
                          </a>
                        </li>
                    </div>

                    <div id="imageModal" class="modal-user" style="display: none;">
                        <div class="modal-contente">
                            <span class="close" id="closeModal">&times;</span>
                            <img id="modalImage" src="../assets/do-utilizador 1.png" alt="Imagem do perfil">
                            <h5>Para melhor visualização coloque uma imagem redonda</h5>
                            <div class="divisor-bottons">
                                <button id="removeButton" class="small-button">Remover</button>
                                <input type="file" id="fileInput" accept="image/*" style="display: none;">
                                <button id="replaceButton" class="small-button">Trocar</button>
                            </div>
                        </div>
                    </div>
                    <div class="divisao-botoes">
                        <li>
                            <a href="./dashboard.html" class="a">
                                <i class='bx bxs-home'></i>
                                <span class="links_name">Home</span>
                            </a>
                            <span class="tooltip">Home</span>
                        </li>
                        <li style="display: block;" id="menu">
                            <a href="./funcionario.html" class="a">
                                <i class='bx bxs-user-plus'></i>
                                <span class="links_name">Cadastrar</span>
                            </a>
                            <span class="tooltip">Cadastrar</span>
                        </li>
                        <li>
                            <a href="../index.html" class="a">
                                <i class='bx bx-log-out'></i>
                                <span class="links_name">Sair</span>
                            </a>
                            <span class="tooltip">Sair</span>
                        </li>
                    </div>
                    <div class="switch">
                        <label class="checkboxWrap">
                            <input type="checkbox" id="themeSwitcher" class="checkboxInput">
                            <span class="checkboxMark"></span>
                        </label>
                    </div>
                </ul>
            </div>
        </div>
    </div>

    <script>
        let btn = document.querySelector("#btn");
        let sidebar = document.querySelector(".sidebar");

        btn.onclick = function () {
            sidebar.classList.toggle("active");
        }
    </script>

    <div class="container">
        <div class="content">
            <div class="content-bottons">
                <div class="title-dispositivo">
                    <h1 id="nameDispositivo">Dispositivo </h1>
                </div>
                <div class="buttons-separation">
                    <div class="buttons">
                        <div class="notification">
                            <button id="notification-button" class="button">
                                <svg class="bell2" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <path fill-rule="evenodd" clip-rule="evenodd"
                                        d="m3.99 16.854-1.314 3.504a.75.75 0 0 0 .966.965l3.503-1.314a3 3 0 0 0 1.068-.687L18.36 9.175s-.354-1.061-1.414-2.122c-1.06-1.06-2.122-1.414-2.122-1.414L4.677 15.786a3 3 0 0 0-.687 1.068zm12.249-12.63 1.383-1.383c.248-.248.579-.406.925-.348.487.08 1.232.322 1.934 1.025.703.703.945 1.447 1.025 1.934.058.346-.1.677-.348.925L19.774 7.76s-.353-1.06-1.414-2.12c-1.06-1.062-2.121-1.415-2.121-1.415z"
                                        fill="#000000" />
                                </svg>
                            </button>
                        </div>
                        <div class="notification">
                            <button id="notification-button" class="button" onclick="delete_dispositivo(idDispositivo)">
                                <svg class="bell2" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <path
                                        d="M5.755,20.283,4,8H20L18.245,20.283A2,2,0,0,1,16.265,22H7.735A2,2,0,0,1,5.755,20.283ZM21,4H16V3a1,1,0,0,0-1-1H9A1,1,0,0,0,8,3V4H3A1,1,0,0,0,3,6H21a1,1,0,0,0,0-2Z" />
                                </svg>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="conteiner">
        <div class="cards-principal">
            <div class="card-segury">
                <span class="h4" id="monitoramento1">CPU</span>
                <div class="information">
                    <div class="data-card">
                        <div class="percentagem" id="percentage1">0%</div>
                        <div class="range-card">
                            <div class="range-card" id="fill1"></div>
                        </div>
                        <p>
                            de 100%
                        </p>
                    </div>
                </div>
            </div>

            <div class="card-segury">
                <span class="h4" id="monitoramento2">RAM</span>
                <div class="information">
                    <div class="data-card">
                        <div class="percentagem" id="percentage2">0%</div>
                        <div class="range-card">
                            <div class="fill-card" id="fill2"></div>
                        </div>
                        <p>
                            de 100%
                        </p>
                    </div>
                </div>

            </div>

            <div class="card-segury">
                <span class="h4" id="monitoramento2">Disco</span>
                <div class="information">
                    <div class="data-card">
                        <div class="percentagem" id="percentage3">0%</div>
                        <div class="range-card">
                            <div class="fill-card" id="fill3"></div>
                        </div>
                        <p>
                            de 100%
                        </p>
                    </div>
                </div>

            </div>

            <div class="card-segury">
                <span class="h4" id="monitoramento2">Rede</span>
                <div class="information">
                    <div class="data-card">
                        <div class="percentagem" id="percentage4">0%</div>
                        <div class="range-card">
                            <div class="fill-card" id="fill4"></div>
                        </div>
                        <p>
                            de 100%
                        </p>
                    </div>
                </div>

            </div>
            <div class="card-segury2">
                <h4>Descrição </h4>
                <p>Firewall 2 está localizado no 11º andar e é responsavel por monitorar do 5º andar até o 12º andar.
                </p>
            </div>
        </div>
    </div>

    <div class="container">
        <div class="container-grafico">
            <div class="chart">
                <p>CPU - % de utilização</p>
                <canvas id="myChart" style="position: relative; height:25vh; width:35vw;"></canvas>
                <p>tempo em minutos</p>
            </div>

            <div class="chart">
                <p>RAM - Uso da memoria</p>
                <canvas id="myChart2" style="position: relative; height:25vh; width:35vw;"></canvas>
                <p>tempo em minutos</p>
            </div>
            <div class="chart">
                <p>Disco - Uso da memoria</p>
                <canvas id="myChart3" style="position: relative; height:25vh; width:35vw;"></canvas>
                <p>tempo em minutos</p>
            </div>

            <div class="chart">
                <p>Rede - Taxa de transferência</p>
                <canvas id="myChart4" style="position: relative; height:25vh; width:35vw;"></canvas>
                <p>tempo em minutos</p>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <script src="script.js"></script>
    <script>
        menuNivelUsuario();
        function menuNivelUsuario() {
            var tipo = sessionStorage.TIPO_USUARIO;
            var menu = document.getElementById("menu");

            if (tipo == "convencional") {
                menu.style.display = "none";
            }

        }
    </script>

<script src="./notificacoes.js"></script>


    <script type="module" src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.esm.js"></script>
    <script nomodule src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.js"></script>
    <script src="../js/changeTheme.js"></script>
</body>

<script>
    //Get idDispositivo from url and put into nameDispositivo html
    var url = new URL(window.location.href);
    var idDispositivo = url.searchParams.get("idDispositivo");
    document.getElementById("nameDispositivo").innerHTML += idDispositivo;
</script>

<script>

    function delete_dispositivo(idDispositivo){
          fetch(`/usuarios/delete_dispositivo/${idDispositivo}`, {
            method: 'PUT',
            headers: {
              "Content-Type": "application/json"
            },
            body: JSON.stringify({
            }),
          })
            .then(function (resposta) {
              if (resposta.ok) {
                 abrirModal();
              } else {
                throw new Error("Houve um erro ao tentar realizar o cadastro!");
               window.alert("deu erro");
              }
            })
            .catch(function (resposta) {
              console.log("#ERRO: " + resposta);
            });

          return false;
        }
</script>
<script>
    var funcionario = sessionStorage.NOME_USUARIO;
    name_user.innerHTML = funcionario;

    //Este bloco recebe do localStorage o thema definido pelo usuário e aplica a está página.
    var backgroundColor;
    var borderColor;
    var textColor;
    if (localStorage.getItem('theme') == "dark") {
        backgroundColor = 'rgba(255, 255, 255, 0.1)';
        borderColor = 'rgba(255, 255, 255, 1)';
        textColor = 'rgba(255, 255, 255, 1)';
    } else {
        backgroundColor = 'rgba(0, 0, 0, 0.1)';
        borderColor = 'rgba(0, 0, 0, 1)';
        textColor = 'rgba(0, 0, 0, 1)';
    }

    let proximaAtualizacao;

    function obterRegistrosCapturados() {
        if (proximaAtualizacao != undefined) {
            clearTimeout(proximaAtualizacao);
        }

        //Ultimas medidas da CPU
        fetch(`/dashboard/ultimasCpu`, { cache: 'no-store' }).then(function (response) {
            if (response.ok) {
                response.json().then(function (respostaCpu) {
                    console.log(respostaCpu)
                    console.log(`Dados recebidos: ${JSON.stringify(respostaCpu)}`);
                    respostaCpu.reverse();
                    plotarGraficoCPU(respostaCpu);
                });
            } else {
                console.error('Nenhum dado encontrado ou erro na API');
            }
        }).catch(function (error) {
            console.error(`Erro na obtenção dos dados p/ gráfico de CPU: ${error.message}`);
        });

        //Ultimas medidas da RAM
        fetch(`/dashboard/ultimas`, { cache: 'no-store' }).then(function (response) {
            if (response.ok) {
                response.json().then(function (resposta) {
                    console.log(resposta)
                    console.log(`Dados recebidos: ${JSON.stringify(resposta)}`);
                    resposta.reverse();
                    plotarGraficoRAM(resposta);
                });
            } else {
                console.error('Nenhum dado encontrado ou erro na API');
            }
        }).catch(function (error) {
            console.error(`Erro na obtenção dos dados p/ gráfico: ${error.message}`);
        });

        //Ultimas medidas da DISCO
        fetch(`/dashboard/ultimasDisco`, { cache: 'no-store' }).then(function (response) {
            if (response.ok) {
                response.json().then(function (respostaDisco) {
                    console.log(respostaDisco)
                    console.log(`Dados recebidos: ${JSON.stringify(respostaDisco)}`);
                    respostaDisco.reverse();
                    plotarGraficoDISCO(respostaDisco);
                });
            } else {
                console.error('Nenhum dado encontrado ou erro na API');
            }
        }).catch(function (error) {
            console.error(`Erro na obtenção dos dados p/ gráfico: ${error.message}`);
        });

        //Ultimas medidas da REDE
        fetch(`/dashboard/ultimasRede`, { cache: 'no-store' }).then(function (response) {
            if (response.ok) {
                response.json().then(function (respostaRede) {
                    console.log(respostaRede)
                    console.log(`Dados recebidos: ${JSON.stringify(respostaRede)}`);
                    respostaRede.reverse();
                    plotarGraficoREDE(respostaRede);
                });
            } else {
                console.error('Nenhum dado encontrado ou erro na API');
            }
        }).catch(function (error) {
            console.error(`Erro na obtenção dos dados p/ gráfico: ${error.message}`);
        });
    }

    /*RAM*/
    function plotarGraficoRAM(resposta) {
        console.log('Iniciando plotagem dos gráficos...');

        //Criando estrutura que receberá as labels dinâmicamente
        const labels = [];

        //Criando estrutura do gráfico RAM
        const data = {
            labels: labels,
            datasets: [{
                label: 'RAM',
                backgroundColor: backgroundColor,
                borderColor: borderColor,
                //A listagem de data precisa estar vazia para receber os dados da plotagem
                data: [],
            }]
        };
        console.log('----------------------------------------------');
        console.log('Estes dados foram recebidos pela função "obterRegistrosCapturados" e passados para "plotarGraficoRAM":');
        console.log(resposta);

        // Inserindo valores recebidos em estrutura para plotar o gráfico
        //provavelmente para cada gráfico específico será necessário mudar a query na model para capturar o tipoComponente
        for (i = 0; i < resposta.length; i++) {
            var registro = resposta[i];
            labels.push(registro.momento_grafico);
            data.datasets[0].data.push(registro.captura);

        }

        const captura = registro.captura;

        console.log('----------------------------------------------')
        console.log('O gráfico será plotado com os respectivos valores:')
        console.log('Labels:')
        console.log(labels)
        console.log('Dados:')
        console.log(data.datasets)
        console.log('----------------------------------------------')


        /* Configurando o gráfico da RAM */
        const config = {
            type: 'line',
            data: data,
            options: {
                plugins: {
                    legend: {
                        labels: {
                            fontSize: 15, // Ajusta o tamanho da fonte para a legenda
                            color: textColor // Ajusta a cor do texto da legenda
                        }
                    }
                },
                scales: {
                    y: {
                        ticks: {
                            fontSize: 15, // Ajusta o tamanho da fonte para os ticks do eixo y
                            color: textColor // Ajusta a cor do texto dos ticks do eixo y
                        }
                    },
                    x: {
                        ticks: {
                            fontSize: 15, // Ajusta o tamanho da fonte para os ticks do eixo x
                            color: textColor // Ajusta a cor do texto dos ticks do eixo x
                        }
                    }
                }
            }
        };

        //Adicionando o gráfico da RAM em DIV
        const myChart = new Chart(
            document.getElementById('myChart'),
            config
        );
        setTimeout(() => updateProgressBar(captura, 'fill2', 'percentage2'), 1000);
        setTimeout(() => atualizarGrafico(data, myChart), 2000);
    }

    /*REDE*/
    function plotarGraficoREDE(respostaRede) {
        console.log('Iniciando plotagem do gráfico de REDE...');
        /*Criando estrutura para o gráfico de REDE*/
        const labelsRede = [];

        const dataRede = {
            labels: labelsRede,
            datasets: [{
                label: 'REDE',
                backgroundColor: backgroundColor,
                borderColor: borderColor,
                //A listagem de data precisa estar vazia para receber os dados da plotagem
                data: [],
            }]
        };

        console.log('----------------------------------------------');
        console.log('Estes dados foram recebidos pela função "obterRegistrosCapturados" e passados para "plotarGraficoRAM":');
        console.log(respostaRede);


        // Inserindo valores recebidos em estrutura para plotar o gráfico
        //provavelmente para cada gráfico específico será necessário mudar a query na model para capturar o tipoComponente
        for (i = 0; i < respostaRede.length; i++) {
            var registroRede = respostaRede[i];
            labelsRede.push(registroRede.momento_grafico);
            dataRede.datasets[0].data.push(registroRede.captura);
        }

        const capturaRede = registroRede.captura;

        console.log('----------------------------------------------')
        console.log('O gráfico será plotado com os respectivos valores:')
        console.log('Labels:')
        console.log(labelsRede)
        console.log('Dados:')
        console.log(dataRede.datasets)
        console.log('----------------------------------------------')

        /* Configurando o gráfico da REDE */
        const configRede = {
            type: 'line',
            data: dataRede,
            options: {
                plugins: {
                    legend: {
                        labelsRede: {
                            fontSize: 15, // Ajusta o tamanho da fonte para a legenda
                            color: textColor // Ajusta a cor do texto da legenda
                        }
                    }
                },
                scales: {
                    y: {
                        ticks: {
                            fontSize: 15, // Ajusta o tamanho da fonte para os ticks do eixo y
                            color: textColor // Ajusta a cor do texto dos ticks do eixo y
                        }
                    },
                    x: {
                        ticks: {
                            fontSize: 15, // Ajusta o tamanho da fonte para os ticks do eixo x
                            color: textColor // Ajusta a cor do texto dos ticks do eixo x
                        }
                    }
                }
            }
        };

        //Adicionando o gráfico da REDE em DIV
        const myChartRede = new Chart(
            document.getElementById('myChart4'),
            configRede
        );
        setTimeout(() => updateProgressBar(capturaRede, 'fill4', 'percentage4'), 1000);
        setTimeout(() => atualizarGraficoRede(dataRede, myChartRede), 2000);
    }

    /*CPU*/
    function plotarGraficoCPU(respostaCpu) {
        console.log('Iniciando plotagem do gráfico de CPU...');
        /*Criando estrutura para o gráfico de CPU*/
        const labelsCpu = [];

        const dataCpu = {
            labels: labelsCpu,
            datasets: [{
                label: 'CPU',
                backgroundColor: backgroundColor,
                borderColor: borderColor,
                //A listagem de data precisa estar vazia para receber os dados da plotagem
                data: [],
            }]
        };

        console.log('----------------------------------------------');
        console.log('Estes dados foram recebidos pela função "obterRegistrosCapturados" e passados para "plotarGraficoCPU":');
        console.log(respostaCpu);

        // Inserindo valores recebidos em estrutura para plotar o gráfico
        //provavelmente para cada gráfico específico será necessário mudar a query na model para capturar o tipoComponente
        for (i = 0; i < respostaCpu.length; i++) {
            var registroCpu = respostaCpu[i];
            labelsCpu.push(registroCpu.momento_grafico);
            dataCpu.datasets[0].data.push(registroCpu.captura);
        }

        const capturaCpu = registroCpu.captura;

        console.log('----------------------------------------------')
        console.log('O gráfico será plotado com os respectivos valores:')
        console.log('Labels:')
        console.log(labelsCpu)
        console.log('Dados:')
        console.log(dataCpu.datasets)
        console.log('----------------------------------------------')

        /* Configurando o gráfico da CPU */
        const configCpu = {
            type: 'line',
            data: dataCpu,
            options: {
                plugins: {
                    legend: {
                        labelsCpu: {
                            fontSize: 15, // Ajusta o tamanho da fonte para a legenda
                            color: textColor // Ajusta a cor do texto da legenda
                        }
                    }
                },
                scales: {
                    y: {
                        ticks: {
                            fontSize: 15, // Ajusta o tamanho da fonte para os ticks do eixo y
                            color: textColor // Ajusta a cor do texto dos ticks do eixo y
                        }
                    },
                    x: {
                        ticks: {
                            fontSize: 15, // Ajusta o tamanho da fonte para os ticks do eixo x
                            color: textColor // Ajusta a cor do texto dos ticks do eixo x
                        }
                    }
                }
            }
        };

        //Adicionando o gráfico da CPU em DIV
        const myChartCpu = new Chart(
            document.getElementById('myChart2'),
            configCpu
        );
        setTimeout(() => updateProgressBar(capturaCpu, 'fill1', 'percentage1'), 1000);
        setTimeout(() => atualizarGraficoCpu(dataCpu, myChartCpu), 2000);
    }

    /*DISCO*/
    function plotarGraficoDISCO(respostaDisco) {
        console.log('Iniciando plotagem do gráfico de DISCO...');
        /*Criando estrutura para o gráfico de DISCO*/
        const labelsDisco = [];

        const dataDisco = {
            labels: labelsDisco,
            datasets: [{
                label: 'DISCO',
                backgroundColor: backgroundColor,
                borderColor: borderColor,
                //A listagem de data precisa estar vazia para receber os dados da plotagem
                data: [],
            }]
        };

        console.log('----------------------------------------------');
        console.log('Estes dados foram recebidos pela função "obterRegistrosCapturados" e passados para "plotarGraficoDISCO":');
        console.log(respostaDisco);

        // Inserindo valores recebidos em estrutura para plotar o gráfico
        //provavelmente para cada gráfico específico será necessário mudar a query na model para capturar o tipoComponente
        for (i = 0; i < respostaDisco.length; i++) {
            var registroDisco = respostaDisco[i];
            labelsDisco.push(registroDisco.momento_grafico);
            dataDisco.datasets[0].data.push(registroDisco.captura);
        }

        const capturaDisco = registroDisco.captura;

        console.log('----------------------------------------------')
        console.log('O gráfico será plotado com os respectivos valores:')
        console.log('Labels:')
        console.log(labelsDisco)
        console.log('Dados:')
        console.log(dataDisco.datasets)
        console.log('----------------------------------------------')

        /* Configurando o gráfico da DISCO */
        const configDisco = {
            type: 'line',
            data: dataDisco,
            options: {
                plugins: {
                    legend: {
                        labelsDisco: {
                            fontSize: 15, // Ajusta o tamanho da fonte para a legenda
                            color: textColor // Ajusta a cor do texto da legenda
                        }
                    }
                },
                scales: {
                    y: {
                        ticks: {
                            fontSize: 15, // Ajusta o tamanho da fonte para os ticks do eixo y
                            color: textColor // Ajusta a cor do texto dos ticks do eixo y
                        }
                    },
                    x: {
                        ticks: {
                            fontSize: 15, // Ajusta o tamanho da fonte para os ticks do eixo x
                            color: textColor // Ajusta a cor do texto dos ticks do eixo x
                        }
                    }
                }
            }
        };

        //Adicionando o gráfico da DISCO em DIV
        const myChartDisco = new Chart(
            document.getElementById('myChart3'),
            configDisco
        );
        setTimeout(() => updateProgressBar(capturaDisco, 'fill3', 'percentage3'), 1000);
        setTimeout(() => atualizarGraficoDisco(dataDisco, myChartDisco), 2000);
    }

    //Atualizações de gráficos
    function atualizarGrafico(data, myChart) {
        fetch(`/dashboard/tempo-real`, { cache: 'no-store' }).then(function (response) {
            if (response.ok) {
                response.json().then(function (novoRegistro) {
                    console.log(`Dados recebidos: ${JSON.stringify(novoRegistro)}`);
                    console.log(`Dados atuais do gráfico:`);
                    console.log(data);

                    const captura = novoRegistro[0].captura;

                    if (novoRegistro[0].momento_grafico === data.labels[data.labels.length - 1]) {
                        console.log("---------------------------------------------------------------")
                        console.log("Como não há dados novos para captura, o gráfico não atualizará.")
                        console.log("Horário do novo dado capturado:")
                        console.log(novoRegistro[0].momento_grafico)
                        console.log("Horário do último dado de capturado:")
                        console.log(data.labels[data.labels.length - 1])
                        console.log("---------------------------------------------------------------")
                    } else {
                        // Tirar e colocar valores no gráfico
                        data.labels.shift(); // Apagar o primeiro
                        data.labels.push(novoRegistro[0].momento_grafico); // Incluir um novo momento

                        data.datasets[0].data.shift();  // Apagar o primeiro valor capturado
                        data.datasets[0].data.push(captura); // Incluir o novo valor capturado

                        myChart.update();
                    }

                    // Altere aqui o valor em ms se quiser que o gráfico atualize mais rápido ou mais devagar
                    proximaAtualizacao = setTimeout(() => updateProgressBar(captura, 'fill2', 'percentage2'), 1000);
                    proximaAtualizacao = setTimeout(() => atualizarGrafico(data, myChart), 1000);

                });
            } else {
                console.error('Nenhum dado encontrado ou erro na API');
                // Altere aqui o valor em ms se quiser que o gráfico atualize mais rápido ou mais devagar
                proximaAtualizacao = setTimeout(() => updateProgressBar(captura, 'fill2', 'percentage2'), 1000);
                proximaAtualizacao = setTimeout(() => atualizarGrafico(data, myChart), 1000);

            }
        }).catch(function (error) {
            console.error(`Erro na obtenção dos dados para o gráfico: ${error.message}`);
        });

    }

    function atualizarGraficoRede(dataRede, myChartRede) {
        fetch(`/dashboard/tempo-real-rede`, { cache: 'no-store' }).then(function (response) {
            if (response.ok) {
                response.json().then(function (novoRegistro) {
                    console.log(`Dados recebidos: ${JSON.stringify(novoRegistro)}`);
                    console.log(`Dados atuais do gráfico:`);
                    console.log(dataRede);

                    const captura = novoRegistro[0].captura;

                    if (novoRegistro[0].momento_grafico === dataRede.labels[dataRede.labels.length - 1]) {
                        console.log("---------------------------------------------------------------")
                        console.log("Como não há dados novos para captura, o gráfico não atualizará.")
                        console.log("Horário do novo dado capturado:")
                        console.log(novoRegistro[0].momento_grafico)
                        console.log("Horário do último dado capturado:")
                        console.log(dataRede.labels[dataRede.labels.length - 1])
                        console.log("---------------------------------------------------------------")
                    } else {
                        // Tirar e colocar valores no gráfico
                        dataRede.labels.shift(); // Apagar o primeiro
                        dataRede.labels.push(novoRegistro[0].momento_grafico); // Incluir um novo momento

                        dataRede.datasets[0].data.shift();  // Apagar o primeiro valor capturado
                        dataRede.datasets[0].data.push(captura); // Incluir o novo valor capturado

                        myChartRede.update();
                    }
                    // Altere aqui o valor em ms se quiser que o gráfico atualize mais rápido ou mais devagar
                    proximaAtualizacao = setTimeout(() => updateProgressBar(captura, 'fill4', 'percentage4'), 2000);
                    proximaAtualizacao = setTimeout(() => atualizarGraficoRede(dataRede, myChartRede), 2000);
                });
            } else {
                console.error('Nenhum dado encontrado ou erro na API');
                // Altere aqui o valor em ms se quiser que o gráfico atualize mais rápido ou mais devagar
                proximaAtualizacao = setTimeout(() => updateProgressBar(captura, 'fill4', 'percentage4'), 2000);
                proximaAtualizacao = setTimeout(() => atualizarGraficoRede(dataRede, myChartRede), 2000);
            }
        }).catch(function (error) {
            console.error(`Erro na obtenção dos dados para o gráfico: ${error.message}`);
        });
    }

    function atualizarGraficoCpu(dataCpu, myChartCpu) {
        fetch(`/dashboard/tempo-real-cpu`, { cache: 'no-store' }).then(function (response) {
            if (response.ok) {
                response.json().then(function (novoRegistro) {
                    console.log(`Dados recebidos: ${JSON.stringify(novoRegistro)}`);
                    console.log(`Dados atuais do gráfico:`);
                    console.log(dataCpu);

                    const captura = novoRegistro[0].captura;

                    if (novoRegistro[0].momento_grafico === dataCpu.labels[dataCpu.labels.length - 1]) {
                        console.log("---------------------------------------------------------------")
                        console.log("Como não há dados novos para captura, o gráfico não atualizará.")
                        console.log("Horário do novo dado capturado:")
                        console.log(novoRegistro[0].momento_grafico)
                        console.log("Horário do último dado capturado:")
                        console.log(dataCpu.labels[dataCpu.labels.length - 1])
                        console.log("---------------------------------------------------------------")
                    } else {
                        // Tirar e colocar valores no gráfico
                        dataCpu.labels.shift(); // Apagar o primeiro
                        dataCpu.labels.push(novoRegistro[0].momento_grafico); // Incluir um novo momento

                        dataCpu.datasets[0].data.shift();  // Apagar o primeiro valor capturado
                        dataCpu.datasets[0].data.push(captura); // Incluir o novo valor capturado

                        myChartCpu.update();
                    }
                    // Altere aqui o valor em ms se quiser que o gráfico atualize mais rápido ou mais devagar
                    proximaAtualizacao = setTimeout(() => updateProgressBar(captura, 'fill1', 'percentage1'), 2000);
                    proximaAtualizacao = setTimeout(() => atualizarGraficoCpu(dataCpu, myChartCpu), 2000);
                });
            } else {
                console.error('Nenhum dado encontrado ou erro na API');
                // Altere aqui o valor em ms se quiser que o gráfico atualize mais rápido ou mais devagar
                proximaAtualizacao = setTimeout(() => updateProgressBar(captura, 'fill1', 'percentage1'), 2000);
                proximaAtualizacao = setTimeout(() => atualizarGraficoCpu(dataCpu, myChartCpu), 2000);
            }
        }).catch(function (error) {
            console.error(`Erro na obtenção dos dados para o gráfico: ${error.message}`);
        });
    }

    function atualizarGraficoDisco(dataDisco, myChartDisco) {
        fetch(`/dashboard/tempo-real-disco`, { cache: 'no-store' }).then(function (response) {
            if (response.ok) {
                response.json().then(function (novoRegistro) {
                    console.log(`Dados recebidos: ${JSON.stringify(novoRegistro)}`);
                    console.log(`Dados atuais do gráfico:`);
                    console.log(dataDisco);

                    const captura = novoRegistro[0].captura;

                    if (novoRegistro[0].momento_grafico === dataDisco.labels[dataDisco.labels.length - 1]) {
                        console.log("---------------------------------------------------------------")
                        console.log("Como não há dados novos para captura, o gráfico não atualizará.")
                        console.log("Horário do novo dado capturado:")
                        console.log(novoRegistro[0].momento_grafico)
                        console.log("Horário do último dado capturado:")
                        console.log(dataDisco.labels[dataDisco.labels.length - 1])
                        console.log("---------------------------------------------------------------")
                    } else {
                        // Tirar e colocar valores no gráfico
                        dataDisco.labels.shift(); // Apagar o primeiro
                        dataDisco.labels.push(novoRegistro[0].momento_grafico); // Incluir um novo momento

                        dataDisco.datasets[0].data.shift();  // Apagar o primeiro valor capturado
                        dataDisco.datasets[0].data.push(captura); // Incluir o novo valor capturado

                        myChartDisco.update();
                    }
                    // Altere aqui o valor em ms se quiser que o gráfico atualize mais rápido ou mais devagar
                    proximaAtualizacao = setTimeout(() => updateProgressBar(captura, 'fill3', 'percentage3'), 2000);
                    proximaAtualizacao = setTimeout(() => atualizarGraficoDisco(dataDisco, myChartDisco), 2000);
                });
            } else {
                console.error('Nenhum dado encontrado ou erro na API');
                // Altere aqui o valor em ms se quiser que o gráfico atualize mais rápido ou mais devagar
                proximaAtualizacao = setTimeout(() => updateProgressBar(capturaDisco, 'fill3', 'percentage3'), 2000);
                proximaAtualizacao = setTimeout(() => atualizarGraficoDisco(dataDisco, myChartDisco), 2000);
            }
        }).catch(function (error) {
            console.error(`Erro na obtenção dos dados para o gráfico: ${error.message}`);
        });
    }


    // ** Estrutura para parametrizar indicadores de alertas **
    // --------------------------------------------------------
    // if (captura >= 4 && captura <= 6) {
    // dados.datasets[0].borderColor = '#52f90d';
    // dados.datasets[0].label = 'Medida ideal'
    // } else if (
    // (captura >= 2.1 && captura <= 3.9) ||
    // (captura >= 6.1 && captura <= 7.9)
    // ) {
    // dados.datasets[0].borderColor = '#c7a941';
    // dados.datasets[0].label = 'Medida em alerta'
    // } else if (captura > 8) {
    // dados.datasets[0].borderColor = '#c60a14';
    // dados.datasets[0].label = 'Medida excedida'
    // }else {
    // dados.datasets[0].borderColor = '#c60a14';
    // dados.datasets[0].label = 'Medida abaixo'
    // }

</script>

</html>